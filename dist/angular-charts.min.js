angular.module("angularCharts",["angularChartsTemplates"]),angular.module("angularCharts").directive("acChart",["$templateCache","$compile","$rootElement","$window","$timeout","$sce",function(x,v,t,F,H,D){var S=["rgb(255,153,0)","rgb(220,57,18)","rgb(70,132,238)","rgb(73,66,204)","rgb(0,128,0)","rgb(0, 169, 221)","steelBlue","rgb(0, 169, 221)","rgb(50, 205, 252)","rgb(70,132,238)","rgb(0, 169, 221)","rgb(5, 150, 194)","rgb(50, 183, 224)","steelBlue","rgb(2, 185, 241)","rgb(0, 169, 221)","steelBlue","rgb(0, 169, 221)","rgb(50, 205, 252)","rgb(70,132,238)","rgb(0, 169, 221)","rgb(5, 150, 194)","rgb(50, 183, 224)","steelBlue","rgb(2, 185, 241)"];function z(t,e){for(var a=null,n=0;n<t.length;n++)if(angular.isElement(t[n])&&(a=angular.element(t[n])).hasClass(e))return a;return a}return{restrict:"EA",link:function(y,a,t){var b={title:"",tooltips:!0,labels:!1,mouseover:function(){},mouseout:function(){},click:function(){},legend:{display:!0,position:"left",htmlEnabled:!1},colors:S,getBarColor:function(t,e){return null},innerRadius:0,lineLegend:"lineEnd",lineCurveType:"cardinal",isAnimate:!0,yAxisTickFormat:"s",xAxisTickRotate:0,displayHorizontalGrid:!1,threshold:void 0,waitForHeightAndWidth:!1};y.acConfig&&angular.extend(b,y.acConfig);var e,k,C,w,A,T,n,r=a[0].clientWidth,i=a[0].clientHeight;function l(){o()&&(e=y.acData,n=y.acChart,k=e&&e.series||[],C=e&&e.data||[],function(){if(!b.legend.display)return w=i,A=r;switch(b.legend.position){case"top":case"bottom":w=.75*i,A=r;break;case"left":case"right":w=i,A=.75*r}}(),function(){var t=x.get("angularChartsTemplate_"+b.legend.position);a.html(t),v(a.contents())(y);var e=a.find("div");T=z(e,"ac-chart"),z(e,"ac-legend"),w-=z(e,"ac-title")[0].clientHeight}(),(0,{pie:d,bar:s,line:c,area:u,point:p}[n])(),y.legends=[],"pie"===n&&angular.forEach(C,function(t,e){y.legends.push({color:b.colors[e],title:f(t.x)})}),("bar"===n||"area"===n||"point"===n||"line"===n&&"traditional"===b.lineLegend)&&angular.forEach(k,function(t,e){y.legends.push({color:b.colors[e],title:f(t)})}))}function o(){if(i&&r)return!0;if(b.waitForHeightAndWidth)return!1;throw new Error("Please set height and width for the chart element")}function $(t,e){var a=e.domain();if(b.xAxisMaxTicks&&a.length>b.xAxisMaxTicks){var n=Math.ceil(a.length/b.xAxisMaxTicks);t.tickValues(a.filter(function(t,e){return e%n==0}))}}function s(){var t=0,e=20,a=5,n=40;A-=n+e,w-=t+a;var r=d3.scale.ordinal().rangeRoundBands([0,A],.1),i=d3.scale.linear().range([w,10]),l=d3.scale.ordinal().rangeRoundBands([0,A],.1),o=[0];C.forEach(function(a){a.nicedata=a.y.map(function(t,e){return o.push(t),{x:a.x,y:t,s:e,tooltip:angular.isArray(a.tooltip)?a.tooltip[e]:a.tooltip}})});var s=d3.max(C.map(function(t){return t.y.length}));y.yMaxData=s,r.domain(C.map(function(t){return t.x}));var c=.2*d3.max(o);i.domain([d3.min(o),d3.max(o)+c]),l.domain(d3.range(s)).rangeRoundBands([0,r.rangeBand()]);var u=d3.svg.axis().scale(r).orient("bottom");$(u,r);var d=d3.svg.axis().scale(i).orient("left").ticks(10).tickFormat(d3.format(b.yAxisTickFormat)),p=d3.select(T[0]).append("svg").attr("width",A+n+e),g=p.append("g").attr("transform","translate("+n+","+t+")");g.append("g").attr("class","x axis").attr("transform","translate(0,"+w+")").call(u),g.append("g").attr("class","y axis").call(d),b.xAxisTickRotate&&p.selectAll("g.x.axis text").style("text-anchor","end").attr("dx","-.65em").attr("dy","0").attr("transform","rotate("+b.xAxisTickRotate+")");var f=g.select("g.x.axis")[0][0].getBoundingClientRect();maxTickHeight=f.height,p.attr("height",w+t+a+maxTickHeight);var h=g.selectAll(".state").data(C).enter().append("g").attr("class","g").attr("transform",function(t){return"translate("+r(t.x)+",0)"}),m=h.selectAll("rect").data(function(t){return t.nicedata}).enter().append("rect");m.attr("width",l.rangeBand()),m.attr("x",function(t,e){return l(e)}).attr("y",w).style("fill",function(t){return R(t.s,t.y)}).attr("height",0).transition().ease("cubic-in-out").duration(b.isAnimate?1e3:0).attr("y",function(t){return i(Math.max(0,t.y))}).attr("height",function(t){return Math.abs(i(t.y)-i(0))}),null!=b.threshold&&g.append("line").attr("class","threshold").attr("y1",i(b.threshold)).attr("y2",i(b.threshold)).attr("x1",0).attr("x2",A),m.on("mouseover",function(t){M({index:t.x,value:t.tooltip?t.tooltip:t.y,series:k[t.s]},d3.event),b.mouseover(t,d3.event),y.$apply()}).on("mouseleave",function(t){E(),b.mouseout(t,d3.event),y.$apply()}).on("mousemove",function(t){B(0,d3.event)}).on("click",function(t){b.click.call(t,d3.event),y.$apply()}),b.labels&&h.selectAll("not-a-class").data(function(t){return t.nicedata}).enter().append("text").attr("x",function(t,e){return l(e)}).attr("y",function(t){return w-Math.abs(i(t.y)-i(0))}).text(function(t){return t.y}),g.append("line").attr("x1",A).attr("y1",i(0)).attr("y2",i(0)).style("stroke","silver"),b.displayHorizontalGrid&&g.selectAll("line.horizontalGrid").data(i.ticks(10)).enter().append("line").attr({class:"horizontalGrid",x1:0,x2:A,y1:function(t){return i(t)},y2:function(t){return i(t)}})}function c(){var t=0,e=40,a=20,n=40;A-=n+e,w-=t+a;var r=d3.scale.ordinal().domain(C.map(function(t){return t.x})).rangeRoundBands([0,A]),i=d3.scale.linear().range([w,10]),l=d3.svg.axis().scale(r).orient("bottom");$(l,r);var o=d3.svg.axis().scale(i).orient("left").ticks(5).tickFormat(d3.format(b.yAxisTickFormat)),s=d3.svg.line().interpolate(b.lineCurveType).x(function(t){return v(t.x)}).y(function(t){return i(t.y)}),c=[0],u=[];C.forEach(function(t){t.y.map(function(t){c.push(t)})});var d=d3.max(C.map(function(t){return t.y.length}));y.yMaxData=d,k.slice(0,d).forEach(function(t,a){var e={};e.series=t,e.values=C.map(function(e){return e.y.map(function(t){return{x:e.x,y:t,tooltip:e.tooltip}})[a]||{x:C[a].x,y:0}}),u.push(e)});var p=d3.select(T[0]).append("svg").attr("width",A+n+e).attr("height",w+t+a).append("g").attr("transform","translate("+n+","+t+")"),g=.2*d3.max(c);i.domain([d3.min(c),d3.max(c)+g]),p.append("g").attr("class","x axis").attr("transform","translate(0,"+w+")").call(l),p.append("g").attr("class","y axis").call(o);var f=p.selectAll(".points").data(u).enter().append("g"),h=f.attr("points","points").append("path").attr("class","ac-line").style("stroke",function(t,e){return R(e)}).attr("d",function(t){return s(t.values)}).attr("stroke-width","2").attr("fill","none");if(0<u.length){var m=u[u.length-1].values;if(0<m.length){var x=h.node().getTotalLength()+v(m[m.length-1].x);h.attr("stroke-dasharray",x+" "+x).attr("stroke-dashoffset",x).transition().duration(b.isAnimate?1500:0).ease("linear").attr("stroke-dashoffset",0).attr("d",function(t){return s(t.values)})}}function v(t){return Math.round(r(t))+r.rangeBand()/2}return angular.forEach(u,function(t,e){var a,n=p.selectAll(".circle").data(t.values).enter();n.append("circle").attr("cx",function(t){return v(t.x)}).attr("cy",function(t){return i(t.y)}).attr("r",3).style("fill",R(u.indexOf(t))).style("stroke",R(u.indexOf(t))).on("mouseover",(a=t.series,function(t){M({index:t.x,value:t.tooltip?t.tooltip:t.y,series:a},d3.event),b.mouseover(t,d3.event),y.$apply()})).on("mouseleave",function(t){E(),b.mouseout(t,d3.event),y.$apply()}).on("mousemove",function(t){B(d3.event)}).on("click",function(t){b.click(t,d3.event),y.$apply()}),b.labels&&n.append("text").attr("x",function(t){return v(t.x)}).attr("y",function(t){return i(t.y)}).text(function(t){return t.y})}),"lineEnd"===b.lineLegend&&f.append("text").datum(function(t){return{name:t.series,value:t.values[t.values.length-1]}}).attr("transform",function(t){return"translate("+v(t.value.x)+","+i(t.value.y)+")"}).attr("x",3).text(function(t){return t.name}),u}function u(){var t=0,e=40,a=20,n=40;A-=n+e,w-=t+a;var r=d3.scale.ordinal().domain(C.map(function(t){return t.x})).rangePoints([0,A]),i=d3.scale.linear().range([w,10]),l=d3.svg.axis().scale(r).orient("bottom");$(l,r);var o=d3.svg.axis().scale(i).orient("left").ticks(5).tickFormat(d3.format(b.yAxisTickFormat));d3.svg.line().interpolate(b.lineCurveType).x(function(t){return h(t.x)}).y(function(t){return i(t.y)});var s=[0],c=[];C.forEach(function(t){t.y.map(function(t){s.push(t)})});var u=d3.max(C.map(function(t){return t.y.length}));y.yMaxData=u,k.slice(0,u).forEach(function(t,a){var e={};e.series=t,e.values=C.map(function(e){return e.y.map(function(t){return{x:e.x,y:t}})[a]||{x:C[a].x,y:0}}),c.push(e)});var d=d3.select(T[0]).append("svg").attr("width",A+n+e).attr("height",w+t+a).append("g").attr("transform","translate("+n+","+t+")"),p=.2*d3.max(s);i.domain([d3.min(s),d3.max(s)+p]),d.append("g").attr("class","x axis").attr("transform","translate(0,"+w+")").call(l),d.append("g").attr("class","y axis").call(o);var g=d.selectAll(".points").data(c).enter().append("g"),f=d3.svg.area().interpolate("basis").x(function(t){return h(t.x)}).y0(function(){return i(0)}).y1(function(t){return i(0+t.y)});function h(t){return Math.round(r(t))+r.rangeBand()/2}g.append("path").attr("class","area").attr("d",function(t){return f(t.values)}).style("fill",function(t,e){return R(e)}).style("opacity","0.7")}function d(){var t=Math.min(A,w)/2,e=d3.select(T[0]).append("svg").attr("width",A).attr("height",w).append("g").attr("transform","translate("+A/2+","+w/2+")"),a=0;if(b.innerRadius){var n=b.innerRadius;0<=(n="string"==typeof n&&0<n.indexOf("%")?t*(.01*parseFloat(n)):Number(n))&&(a=n)}y.yMaxData=C.length;var r=d3.svg.arc().outerRadius(t-10).innerRadius(a);d3.svg.arc().outerRadius(t+5).innerRadius(0);var i=d3.layout.pie().sort(null).value(function(t){return t.y[0]}),l=e.selectAll(".arc").data(i(C)).enter().append("g"),o=!1;l.append("path").style("fill",function(t,e){return R(e)}).transition().ease("linear").duration(b.isAnimate?500:0).attrTween("d",function(t){t.innerRadius=0;var e=d3.interpolate({startAngle:0,endAngle:0},t);return function(t){return r(e(t))}}).attr("class","arc").each("end",function(){o||(o=!0,l.on("mouseover",function(t){M({value:t.data.tooltip?t.data.tooltip:t.data.y[0]},d3.event),d3.select(this).select("path").transition().duration(200).style("stroke","white").style("stroke-width","2px"),b.mouseover(t,d3.event),y.$apply()}).on("mouseleave",function(t){d3.select(this).select("path").transition().duration(200).style("stroke","").style("stroke-width",""),E(),b.mouseout(t,d3.event),y.$apply()}).on("mousemove",function(t){B(0,d3.event)}).on("click",function(t){b.click(t,d3.event),y.$apply()}))}),b.labels&&l.append("text").attr("transform",function(t){return"translate("+r.centroid(t)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(t){return t.data.y[0]})}function p(){var t=0,e=40,a=20,n=40;A-=n-e,w-=t-a;var r=d3.scale.ordinal().domain(C.map(function(t){return t.x})).rangeRoundBands([0,A]),i=d3.scale.linear().range([w,10]),l=d3.svg.axis().scale(r).orient("bottom");$(l,r);var o=d3.svg.axis().scale(i).orient("left").ticks(5).tickFormat(d3.format(b.yAxisTickFormat)),s=[0],c=[];C.forEach(function(t){t.y.map(function(t,e){s.push(t)})});var u=d3.max(C.map(function(t){return t.y.length}));y.yMaxPoints=u,k.slice(0,u).forEach(function(t,a){var e={};e.series=t,e.values=C.map(function(e){return e.y.map(function(t){return{x:e.x,y:t}})[a]||{x:C[a].x,y:0}}),c.push(e)});var d=d3.select(T[0]).append("svg").attr("width",A+n+e).attr("height",w+t+a).append("g").attr("transform","translate("+n+","+t+")"),p=.2*d3.max(s);function g(t){return Math.round(r(t))+r.rangeBand()/2}i.domain([d3.min(s),d3.max(s)+p]),d.append("g").attr("class","x axis").attr("transform","translate(0,"+w+")").call(l),d.append("g").attr("class","y axis").call(o),d.selectAll(".points").data(c).enter().append("g"),angular.forEach(c,function(t,e){var a,n=d.selectAll(".circle").data(t.values).enter();n.append("circle").attr("cx",function(t){return g(t.x)}).attr("cy",function(t){return i(t.y)}).attr("r",3).style("fill",R(c.indexOf(t))).style("stroke",R(c.indexOf(t))).on("mouseover",(a=t.series,function(t){M({index:t.x,value:t.tooltip?t.tooltip:t.y,series:a},d3.event),b.mouseover(t,d3.event),y.$apply()})).on("mouseleave",function(t){E(),b.mouseout(t,d3.event),y.$apply()}).on("mousemove",function(t){B(d3.event)}).on("click",function(t){b.click(t,d3.event),y.$apply()}),b.labels&&n.append("text").attr("x",function(t){return g(t.x)}).attr("y",function(t){return i(t.y)}).text(function(t){return t.y})})}function M(t,e){if(b.tooltips){t="function"==typeof b.tooltips?b.tooltips(t):t.value;var a=angular.element('<p class="ac-tooltip"></p>').html(t).css({left:e.pageX+20+"px",top:e.pageY-30+"px"});angular.element(document.querySelector(".ac-tooltip")).remove(),angular.element(document.body).append(a),y.$tooltip=a}}function E(){y.$tooltip&&y.$tooltip.remove()}function B(t,e){y.$tooltip&&y.$tooltip.css({left:e.pageX+20+"px",top:e.pageY-30+"px"})}o();var g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function f(t){return D.trustAsHtml(b.legend.htmlEnabled?t:String(t).replace(/[&<>"'\/]/g,function(t){return g[t]}))}function R(t,e){if("bar"===n&&"function"==typeof b.getBarColor&&null!==(a=b.getBarColor(t,e)))return a;if(t<b.colors.length)return b.colors[t];var a="#"+(Math.round(127*Math.random())+127).toString(16)+(Math.round(127*Math.random())+127).toString(16)+(Math.round(127*Math.random())+127).toString(16);return b.colors.push(a),a}var h=angular.element(F),m=null;h.bind("resize",function(t){m&&H.cancel(m),m=H(function(){r=a[0].clientWidth,i=a[0].clientHeight,l()},100)}),y.getWindowDimensions=function(){return{h:h[0].clientHeight,w:h[0].clientWidth}},y.$watch("[acChart, acData, acConfig]",l,!0),y.$watch(function(){return{w:a[0].clientWidth,h:a[0].clientHeight}},function(t){r=t.w,i=t.h,l()},!0)},transclude:"true",scope:{acChart:"=",acData:"=",acConfig:"="}}}]),function(){var e=".angular-charts-template .axis path,.angular-charts-template .axis line{fill:none;stroke:#333}.angular-charts-template line.horizontalGrid{fill:none;stroke:rgba(0,0,0,.2);stroke-width:1px;shape-rendering:crispEdges}.angular-charts-template line.threshold{fill:none;stroke:red;stroke-width:1px;shape-rendering:crispEdges}.angular-charts-template .ac-title{font-weight:700;font-size:1.2em}.angular-charts-template .ac-chart{float:left;width:75%}.angular-charts-template .ac-line{fill:none;stroke-width:2px}.angular-charts-template table{float:left;max-width:25%;list-style:none;margin:0;padding:0}.angular-charts-template td[ng-bind]{display:inline-block}.angular-charts-template .ac-legend-box{border-radius:5px;height:15px;width:15px}.ac-tooltip{display:block;position:absolute;border:2px solid rgba(51,51,51,.9);background-color:rgba(22,22,22,.7);border-radius:5px;padding:5px;color:#fff}",a=document.createElement("style");if(document.getElementsByTagName("head")[0].appendChild(a),a.styleSheet)a.styleSheet.disabled||(a.styleSheet.cssText=e);else try{a.innerHTML=e}catch(t){a.innerText=e}}(),angular.module("angularChartsTemplates",["angularChartsTemplate_left","angularChartsTemplate_right"]),angular.module("angularChartsTemplate_left",[]).run(["$templateCache",function(t){t.put("angularChartsTemplate_left",'<div class="angular-charts-template"><div class="ac-title" ng-if="acConfig.title !== false">{{acConfig.title}}</div><div class="ac-legend" ng-show="{{acConfig.legend.display}}"><table><tr ng-repeat="l in legends"><td><div class="ac-legend-box" ng-attr-style="background:{{l.color}};"></div></td><td ng-bind-html="l.title"></td></tr></table></div><div class="ac-chart"></div></div>')}]),angular.module("angularChartsTemplate_right",[]).run(["$templateCache",function(t){t.put("angularChartsTemplate_right",'<div class="angular-charts-template"><div class="ac-title" ng-if="acConfig.title !== false">{{acConfig.title}}</div><div class="ac-chart"></div><div class="ac-legend" ng-show="{{acConfig.legend.display}}"><table><tr ng-repeat="l in legends | limitTo:yMaxData"><td><div class="ac-legend-box" ng-attr-style="background:{{l.color}};"></div></td><td ng-bind-html="l.title"></td></tr></table></div></div>')}]);